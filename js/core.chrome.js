// Core.Packed: 12/05/2010 14:09:34
Extensions={getExtension:function(e){var t="manifest.json",n=new XMLHttpRequest;n.open("GET",t,!0),n.send(),n.onreadystatechange=function(){n.readyState==4&&e&&e(JSON.parse(n.responseText))}}},Tooltip=(new Class({options:{timeouts:{open:300,close:50},dontCloseOnElement:!1,removeTitle:!0,onOpen:function(){this.source.addClass("tooltip-source-open")},onClose:function(){this.source.removeClass("tooltip-source-open")}},initialize:function(e,t,n){var r=this;return this.source=e,this.setOptions(n),this.element=document.createElement("div"),this.element.style.cssText="position: absolute; top: -10000px; left: -10000px;",this.element.className="tooltip",this.source.addEventListener("mouseover",function(e){e.stopPropagation(),r.open()},!1),this.source.addEventListener("mouseout",function(e){e.stopPropagation(),e.relatedTarget!==r.element&&r.close()},!1),this.element.addEventListener("mouseover",function(e){e.stopPropagation(),r.options.dontCloseOnElement&&r.open()},!1),this.element.addEventListener("mouseout",function(e){e.stopPropagation(),e.relatedTarget!==r.source&&r.close()},!1),this.setContent(t),this.source.tooltip=this,document.body.appendChild(this.element),this.options.removeTitle&&this.source.removeAttribute("title"),this},updateFromTitle:function(){return this.setContent(this.source.title),this.options.removeTitle&&(this.source.title=""),this},setContent:function(e){return e?(typeof e=="string"?this.element.innerHTML=e:this.element.appendChild(e),this.content=e,this):this},open:function(){if(!this.content)return!1;this.timerClose&&(this.timerClose=$clear(this.timerClose));if(!this.timerOpen){this.timerOpen=this.open.delay(this.options.timeouts.open,this);return}return this.isOpen?this:(Tooltip.current&&Tooltip.current!=this&&Tooltip.current.close(),this.isOpen=!0,this.element.addClass("tooltip-open"),this.pos(),this.invokeEvent("open"),Tooltip.current=this,this)},close:function(){this.timerOpen&&(this.timerOpen=$clear(this.timerOpen));if(this.isOpen===!1)return this;if(!this.timerClose){this.timerClose=this.close.delay(this.options.timeouts.close,this);return}return event&&event.type?this:(this.isOpen=!1,this.element.removeClass("tooltip-open"),function(){this.element.style.left="-1000px",this.element.style.top="-1000px",this.element.style.opacity=0,this.invokeEvent("close")}.delay(150,this),Tooltip.current=null,this)},pos:function(){var e=this.source;if(!e.getBoundingClientRect)return this;var t=window.innerHeight-(document.body.offsetWidth>window.innerWidth?20:0),n=window.innerWidth-(document.body.offsetHeight>window.innerHeight?20:0),r=e.getBoundingClientRect(),i,s,o=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),u=Math.max(document.documentElement.scrollTop,document.body.scrollTop);i=r.left+o,s=r.top+u;var a=i,f=s;return i-=document.documentElement.clientLeft,s-=document.documentElement.clientTop,i+=e.offsetWidth+10,s+=e.offsetHeight,i+this.element.offsetWidth>n+o&&(i=n-this.element.offsetWidth+o),s+this.element.offsetHeight>t+u&&(s=t-this.element.offsetHeight+u),s-=4,s<f+11&&(s=f-this.element.offsetHeight),s<0&&(s=0,i=a-this.element.offsetWidth),this.element.style.top=s+"px",this.element.style.left=i+"px",this}})).implement(new Options,new Events),BSync=function(e){return this.initialize(e),this},BSync.prototype={options:{debug:!1,interval:(450+Math.floor(Math.random()*25))*1e3,newLine:"\n",idleInterval:2e5,name:null,deleteOther:!0,parent:null,testNetwork:!1,networkTimeout:3e3,folder:"BSync",onError:function(e){console.log("BSYNC ERROR : "+e),this.options&&this.options.debug&&console.log("ERROR: "+e)}},initialize:function(e){var t=this;return this.setOptions(e),this.options.debug,this.options.parent||chrome.bookmarks.getChildren("0",function(e){e.forEach(function(e,n){t.options.parent=e.id})}),this},attach:function(){var e=this;if(this.isAttached)return this;if(!this.options.name)return Extensions.getExtension(function(t){e.options.name=t.name,e.attach()}),this;this.isAttached=!0;if(!this.options.name||!this.options.folder)throw"No name (name or folder) given, bailing out";return!this.options.debug&&parseInt(this.options.interval)<12e4&&(this.options.interval=12e4),setTimeout(function(){e.traverse()},1e4),chrome.bookmarks.onCreated.addListener(function(t,n){var r;n.url&&e.folder&&e.folder.id==n.parentId&&(r=e.isValidBookmark(n))&&function(){if(!e.bookmark||parseInt(e.syncedAt)==parseInt(r)||e.bookmark.id===n.id)return!1;e.stop(),e.options.debug&&console.log("REMOVING AND PROCEESSING ON CREATED"),n.syncedAt=r,e.process(n,!0),e.start()}.delay(800,this)}),chrome.bookmarks.onRemoved.addListener(function(t,n){e.options.debug&&n.url==undefined&&console.log("onRemoved self.folder.id:"+e.folder.id+", id: "+t+" title:"+n.title),e.folder&&t==e.folder.id&&(e.folder=null)}),this},testNetwork:function(){var e=new XMLHttpRequest,t=this,n=setTimeout(function(){return t.error("NO_NETWORK"),this},this.options.networkTimeout);return e.open("GET","http://www.google.com/favicon.ico",!0),e.send(),e.onreadystatechange=function(){e.readyState==4&&(s,clearTimeout(n),n=null,e.responseText.length>100&&t.traverse(!0))},this},getFolder:function(){var e=this;if(this.folder)return this.folder;var t,n=[],r=[];return chrome.bookmarks.getChildren(this.options.parent.toString(),function(i){var s=0;i.forEach(function(i,o){i.title.match(new RegExp("^.+?\\.([0-9]{10,}?)$"))&&n.push(i);if(i.title===e.options.folder&&i.url===undefined)return i.dateAdded>s&&(t=i,s=i.dateAdded),r.push(i),this}),t?r.forEach(function(e,n){e.id!==t.id&&chrome.bookmarks.removeTree(e.id)}):t=chrome.bookmarks.create({parentId:e.options.parent.toString(),title:e.options.folder}),t&&n&&n.forEach(function(e,n){chrome.bookmarks.move(e.id,{parentId:t.id.toString()})}),e.folder=t,e.traverse(!0)}),!1},traverse:function(e){var t=this,n=[],r,i,s=this.folder,o;return!e&&this.options.testNetwork&&!this.folder?this.testNetwork():(this.lastTraversed?(this.options.debug&&console.log("TRAVERSED DIFF : "+((new Date).getTime()-this.lastTraversed)/1e3),this.lastTraversed=(new Date).getTime()):this.lastTraversed=(new Date).getTime(),this.options.getUpdate&&this.options.getUpdate()&&this.syncedAt&&(new Date).getTime()-this.options.getUpdate()<this.options.idleInterval?(console.log("WAITING FOR "+this.idleInterval+"  TO GET UN-IDLE"),setTimeout(function(){t.traverse()},this.options.idleInterval*2),this):s?(chrome.bookmarks.getChildren(s.id.toString(),function(e){var i=0,s;return e.forEach(function(e,o){if(s=t.isValidBookmark(e))t.options.deleteOther&&n.push(e),e.url.indexOf("void")!=-1&&s>i&&(r=e,r.syncedAt=s,i=s)}),r?(t.options.deleteOther&&n.forEach(function(e,t){if(String(e.id)!=String(r.id))try{chrome.bookmarks.remove(String(e.id))}catch(n){}}),t.synced=r.syncedAt,t.bookmark=t.bookmark||r,t.process(r)):(t.options.debug&&console.log("NO BOOKMARK FOUND  > WRITING"),t.options.onWrite(),t.options.onError("MISSING BOOKMARK"))}),this.start()):this.getFolder())},process:function(e,t){var n,r=this;if(!(n=this.getJSON(e)))return r.options.debug&&console.log(" NO CONTENT FOUND > WRITING"),this.options.onWrite(),this.options.onError("NO CONTENT");this.content=n;var i=this.syncedAt;return this.syncedAt=e.syncedAt,!t&&this.shouldWrite()?(r.options.debug&&console.log("\nAbout to write"),this.options.onWrite(n,e)):this.shouldRead()?(r.options.debug&&console.log("\nAbout to read"),this.syncedAtPrevious=this.syncedAt,this.markTimestamp(),this.bookmark=e,this.options.onRead(n,e)):r.options.debug&&console.log(" NOTHING TO DO :) "),this},shouldRead:function(){return this.options.debug&&(console.log("\n\nChecking shouldRead()"),console.log("this.syncedAtPrevious: "+this.syncedAtPrevious),console.log("this.syncedAt: "+this.syncedAt),console.log("his.options.getUpdate(): "+this.options.getUpdate())),this.options.getUpdate()===undefined||this.content&&this.syncedAt>this.options.getUpdate()},shouldWrite:function(){return this.options.debug&&(console.log("\n\nChecking shouldWrite()"),console.log("this.syncedAtPrevious: "+this.syncedAtPrevious),console.log("this.syncedAt: "+this.syncedAt),console.log("his.options.getUpdate(); "+this.options.getUpdate())),!this.content||this.options.getUpdate()&&this.options.getUpdate()>this.syncedAt},write:function(e){var t=this;if(this.content&&JSON.stringify(this.content)===JSON.stringify(e))return t.options.debug&&console.log("SORRY SAME CONTENT / BAILING OUT"),!1;if(this.bookmark&&this.bookmark.id)try{chrome.bookmarks.remove(String(this.bookmark.id))}catch(n){}this.syncedAtPrevious=this.syncedAt,this.syncedAt=this.options.getUpdate()||(new Date).getTime();var r=function(e){return each(e,function(n,r){n&&n.toLowerCase&&n.toLowerCase()&&e[r]==n.replace(new RegExp("("+String.fromCharCode(10)+"|"+String.fromCharCode(13)+")","g"),t.options.newLine)}),e};return e=r(e),chrome.bookmarks.create({parentId:this.folder.id.toString(),title:this.options.name+"."+this.syncedAt,url:"javascript:void('"+JSON.stringify(e)+"');void("+Math.random()*1e3+");"},function(e){t.bookmark=e}),t.options.debug&&console.log("\nWROTE > "+JSON.stringify(e)),this.markTimestamp(!0),this},start:function(){if(!this.isAttached)return this.attach();var e=this;return this.timer=setTimeout(function(){e.traverse()},this.options.interval),this.isRunning=!0,this},stop:function(){return this.isRunning?(clearTimeout(this.timer),this.timer=null,this.isRunning=!1,this):this},setOptions:function(e){var t=this,n,r;for(var i in e)typeof e[i]=="function"?this.options[i]=e[i].bind(this):this.options[i]=e[i];return this},markTimestamp:function(e){return this["synced"+(e?"To":"From")]=(new Date).getTime(),this},getJSON:function(e){var t=e.url,n,r="";t=t.replace(/^.*?void\('(.*?)'\);void.*?$/,"$1"),t=t.replace(new RegExp(this.options.newLine,"g"),String.fromCharCode(10));if(t)try{r=JSON.parse(t)}catch(i){r=""}return r},isValidBookmark:function(e){var t;return e?(t=e.title.match(new RegExp("^"+this.options.name+"\\."+"([0-9]{10,}?)$")))?(e.syncedAt=t[1],parseInt(t[1])):!1:!1}},Graph=(new Class({options:{key:"value",min:null,max:null,fill:!1,stroke:!0,ctx:{strokeStyle:"green",fillStyle:"white"}},initialize:function(e,t,n){return this.setOptions(n),alert,this.container=$(t),this.container.innerHTML="",this.container.style.position.match(/(relative|absolute)/)||(this.container.style.position="relative"),this.series=e?e:[],this},setSeries:function(e){return this.series=e,this.draw()},setTicks:function(e){this.options.ticks=e},addSeries:function(e){return this.series.push(e),this.draw()},getMin:function(){if(this.options.min)return this.options.min;var e=null,t=0;return this.series.each(function(n,r){n.data.length>t&&(t=n.data.length),n.data.each(function(t,n){if(e===null||t<e)e=t},this)},this),this.total=t,this.min=e,this.min},getMax:function(){if(this.options.max)return this.options.max;var e=null;return this.series.each(function(t,n){t.data.each(function(t,n){if(e===null||t>e)e=t},this)},this),this.max=e,this.max},getTotal:function(){return this.total},draw:function(){return this.size=this.size||{width:this.container.clientWidth,height:this.container.clientHeight},this.inner=this.inner||$C("div").injectIn(this.container),this.ticks=this.ticks||$C("div").injectIn(this.container),this.ctx||(this.ticks.style.cssText="position: absolute; left: 0; top: 0;",this.ticks.style.height=this.size.height+"px",this.ticks.style.width=this.size.width+"px"),this.inner.style.overflow="hidden",this.inner.style.width=this.size.width+"px",this.inner.style.height=this.size.height+"px",this.inner.innerHTML=this.ticks.innerHTML="",this.canvas=this.canvas||$C("canvas",{width:this.size.width,height:this.size.height}).injectIn(this.inner),this.ctx=this.ctx||this.canvas.getContext("2d"),this.ctx.clearRect(0,0,this.size.width,this.size.height),this.series.forEach(function(e,t){this.drawSeries(e)},this),this.renderTicks(),this},drawSeries:function(e){var t=e.data,n,r,i,s=this.getMin(),o=this.getMax(),u=this.getTotal(),a=e.ctx&&e.ctx?$merge(this.options.ctx,e.ctx):this.options.ctx;for(var f in a)this.ctx[f]=a[f];this.ctx.beginPath();for(var l=0;l<u;l++)i=t[l],n=this.size.width/(u-1)*l,r=this.options.reverse?(i-s)/(o-s)*this.size.height:this.size.height-(i-s)/(o-s)*this.size.height,l===0&&this.ctx.moveTo(n,r),this.ctx.lineTo(n,r);var c=e.fill!=undefined?e.fill:this.options.fill;c&&(this.ctx.lineTo(this.size.width+100,this.size.height+10),this.ctx.lineTo(0,this.size.height+50),this.ctx.fill());var h=e.stroke!==undefined?e.stroke:this.options.stroke;return h&&this.ctx.stroke(),this},renderTicks:function(){var e,e=$C("div").setClass("graph-tick");e.style.cssText="position: absolute; left: 0;",e.setHTML(this.options.reverse?this.min:this.max),this.ticks.appendChild(e),e.style.marginLeft=-(e.offsetWidth+5)+"px",e.style.top=0,e=$C("div").setClass("graph-tick"),e.style.cssText="position: absolute; left: 0;",e.setHTML(this.options.reverse?this.max:this.min),this.ticks.appendChild(e),e.style.marginLeft=-(e.offsetWidth+5)+"px",e.style.bottom=0,e=$C("div").setClass("graph-tick"),e.style.cssText="position: absolute; left: 0;",e.setHTML(this.options.ticks[0]),this.ticks.appendChild(e),e.style.left=0,e.style.bottom=-(e.offsetHeight+5)+"px",e=$C("div").setClass("graph-tick"),e.style.cssText="position: absolute;;",e.setHTML(this.options.ticks[this.total-1]),this.ticks.appendChild(e),e.style.right=0,e.style.bottom=-(e.offsetHeight+5)+"px"}})).implement(new Options,new Events),Overlay=(new Class({options:{duration:{open:.15,hide:.1},append:{before:null,after:null},esc:!0},initialize:function(e){this.setOptions(e);var t=this;return this.element=$C("div").setClass("overlay"),this.element.style.cssText="position: fixed; top: 50%; left: 50%;z-index: 9999999;opacity: 0;",document.body.appendChild(this.element),this.window=$C("div").addClass("overlay-window"),this.window.style.cssText="position: fixed; width: 100%; height: 100%; top: 0; left: 0; -index: 999999;",document.body.appendChild(this.window),this.elements={before:$C("div").injectIn(this.element).addClass("overlay-before").injectIn(this.element),content:$C("div").injectIn(this.element).addClass("overlay-content").injectIn(this.element),after:$C("div").injectIn(this.element).addClass("overlay-after").injectIn(this.element)},window.addEventListener("keydown",function(e){e.keyCode==27&&t.options.esc&&t.close()},!1),this.hide()},open:function(e){return e&&this.setContent(e),this.isOpen=!0,this.element.style.webkitTransition="opacity "+this.options.duration.open+"s linear",this.window.style.webkitTransition="opacity "+this.options.duration.open+"s linear",this.element.addClass("overlay-open"),this.window.addClass("overlay-window-open"),this.pos(),this},close:function(){return this.isOpen?(this.isOpen=!1,this.element.style.webkitTransition="opacity "+this.options.duration.hide+"s linear",this.window.style.webkitTransition="opacity "+this.options.duration.hide+"s linear",this.element.removeClass("overlay-open"),this.window.removeClass("overlay-window-open"),function(){this.hide()}.delay(this.options.duration.hide*1e3,this),this):this},setContent:function(e){return e?(this.options.append.before&&(this.options.append.before.toLowerCase?this.elements.before.innerHTML=this.options.append.before:this.append.before.nodeName&&(this.elements.before.innerHTML="",this.elements.before.appendChild(this.options.append.before))),this.options.append.after&&(this.options.append.after.toLowerCase?this.elements.after.innerHTML=this.options.append.after:this.append.after.nodeName&&(this.elements.after.innerHTML="",this.elements.after.appendChild(this.options.append.after))),e.toLowerCase?this.elements.content.innerHTML=e:e.nodeName&&(this.elements.content.innerHTML="",this.elements.content.appendChild(e)),this.isOpen?this.pos():this):this},hide:function(){return this.element.style.left=this.window.style.left="-10000px",this},pos:function(){return this.element.style.left=this.element.style.top="50%",this.window.style.left=this.window.style.top="0",this.element.style.marginLeft=-(this.element.offsetWidth/2)+"px",this.element.style.marginTop=-(this.element.offsetHeight/2)+"px",this}})).implement(new Options);
